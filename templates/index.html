<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kariyer PusulasÄ±</title>
    <style>
     /* NÄ°HAÄ° CSS KODU (Son RÃ¶tuÅŸlar UygulanmÄ±ÅŸ) */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;600;700&display=swap');

body {
    font-family: 'SF Pro Display', 'Inter', -apple-system, sans-serif;
    background-color: #dcdcdc;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

#chat-container {
    width: 100%;
    max-width: 390px;
    height: 844px;
    max-height: 90vh;
    /* YENÄ°: Ä°lham alÄ±nan resimdeki yumuÅŸak yeÅŸil-mavi gradyan */
    background: linear-gradient(180deg, hsl(150, 77%, 83%) 0%, #eef3f9 100%);
    border-radius: 40px;
    border: 10px solid #1c1c1e;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
}

#status-bar {
    padding: 18px 30px 10px 30px;
    text-align: left;
}
#time-display {
    font-weight: 600;
    font-size: 0.95rem;
    color: #1c1c1e;
}

#chat-header {
    /* YENÄ°: BaÅŸlÄ±ÄŸÄ± sola hizalama */
    padding: 0 1.8rem 1rem 1.8rem; /* Sol padding artÄ±rÄ±ldÄ±, Ã¼st padding kaldÄ±rÄ±ldÄ± */
    text-align: left;
    font-weight: 700;
    font-size: 1.0 rem; /* Biraz daha belirgin olmasÄ± iÃ§in bÃ¼yÃ¼tÃ¼ldÃ¼ */
    color: #1c1c1e;
    /* ArtÄ±k sÄ±nÄ±ra gerek yok, temiz bir gÃ¶rÃ¼nÃ¼m iÃ§in kaldÄ±rÄ±ldÄ± */
    /* border-bottom: 1px solid #e5e5ea; */
}

#chat-box {
    flex-grow: 1;
    padding: 1rem 1rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}
.feedback-btn.selected {
    background-color: #d1e7ff; /* Biraz daha belirgin bir mavi */
    border-color: #007aff;
    transform: scale(1.1); /* SeÃ§iliyken de bÃ¼yÃ¼k kalsÄ±n */
}


.message {
    display: flex;
    max-width: 80%;
}

.message p {
    padding: 0.7rem 1.1rem;
    border-radius: 1.2rem;
    margin: 0;
    line-height: 1.4;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.bot-message {
    align-self: flex-start;
}
.bot-message p {
    background-color: #ffffff;
    color: #1c1c1e;
    border-top-left-radius: 0.3rem;
}

/* KullanÄ±cÄ± mesajlarÄ± (Ã‡ok Hafif Gri ile gÃ¼ncellenmiÅŸ) */
.user-message {
    align-self: flex-end;
}
.user-message p {
    background-color: #ececec; /* <-- DEÄÄ°ÅTÄ°RÄ°LMÄ°Å HALÄ° */
    color: #3e3e41;
    border-top-right-radius: 0.3rem;
}

#input-area {
    display: flex;
    padding: 0.75rem 1rem;
    margin-bottom: 0.5rem; /* Home indicator'dan biraz ayÄ±rmak iÃ§in */
}
#user-input {
    flex-grow: 1;
    border: none;
    background: #ffffff;
    padding: 0.9rem 1.2rem;
    border-radius: 1.2rem;
    outline: none;
    font-size: 1rem;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

#home-indicator-area {
    padding-bottom: 1rem;
}
#home-indicator {
    width: 135px;
    height: 5px;
    background-color: #4b4b4b; /* Biraz daha yumuÅŸak bir siyah */
    border-radius: 100px;
    margin: 0 auto;
}
    </style>
</head>
<body>
    <div id="chat-container">
        <!-- (DiÄŸer HTML elementleri: status-bar, chat-header vb. aynÄ± kalacak) -->
        <div id="status-bar"><span id="time-display"></span></div>
        <div id="chat-header"><h2>MeslekAtlasÄ±</h2></div>
        <div id="chat-box"></div>
        <div id="input-area"><input type="text" id="user-input" placeholder="Sohbet edin..."></div>
        <div id="home-indicator-area"><div id="home-indicator"></div></div>
    </div>

   <script>
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');

    function addMessageToBox(sender, text, messageId = null, feedback = 0) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', sender + '-message');
        const messageBubble = document.createElement('p');
        messageBubble.textContent = text;
        messageDiv.appendChild(messageBubble);

        if (sender === 'bot' && messageId) {
            const feedbackDiv = document.createElement('div');
            feedbackDiv.className = 'feedback-buttons';
            feedbackDiv.dataset.messageId = messageId;
            feedbackDiv.innerHTML = `
                <button class="feedback-btn ${feedback === 1 ? 'selected' : ''}" onclick="sendFeedback(this, 1)">ğŸ‘</button>
                <button class="feedback-btn ${feedback === -1 ? 'selected' : ''}" onclick="sendFeedback(this, -1)">ğŸ‘</button>
            `;
            messageDiv.appendChild(feedbackDiv);
        }
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function sendFeedback(buttonElement, feedbackValue) {
    // TÄ±klanan butonun ait olduÄŸu feedback grubunu bul
    const feedbackDiv = buttonElement.parentElement;
    const messageId = feedbackDiv.dataset.messageId;

    // Bu gruptaki tÃ¼m butonlardan 'selected' class'Ä±nÄ± kaldÄ±r
    const buttonsInGroup = feedbackDiv.querySelectorAll('.feedback-btn');
    buttonsInGroup.forEach(btn => btn.classList.remove('selected'));

    // Sadece tÄ±klanan butona 'selected' class'Ä±nÄ± ekle
    buttonElement.classList.add('selected');

    // Sunucuya isteÄŸi gÃ¶nder (bu kÄ±sÄ±m zaten doÄŸru Ã§alÄ±ÅŸÄ±yor)
    try {
        await fetch('/feedback', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                message_id: messageId,
                feedback_value: feedbackValue
            })
        });
    } catch (error) {
        console.error('Geri bildirim gÃ¶nderilemedi:', error);
        // Hata durumunda seÃ§imi geri alabiliriz
        buttonElement.classList.remove('selected');
    }
}

    async function handleSendMessage() {
        const messageText = userInput.value.trim();
        if (messageText === "") return;
        addMessageToBox('user', messageText);
        userInput.value = '';
        addMessageToBox('bot', '...');

        try {
            const response = await fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: messageText })
            });
            const data = await response.json();
            chatBox.removeChild(chatBox.lastChild);
            addMessageToBox('bot', data.reply, data.id);
        } catch (error) {
            console.error("Mesaj gÃ¶nderme hatasÄ±:", error);
            addMessageToBox('bot', 'Bir hata oluÅŸtu.');
        }
    }

    document.addEventListener('DOMContentLoaded', async function() {
        const timeDisplay = document.getElementById('time-display');
        function updateTime() {
            const now = new Date();
            timeDisplay.textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        }
        updateTime(); setInterval(updateTime, 30000);

        try {
            const response = await fetch('/get_history', { method: 'POST' });
            const history = await response.json();
            chatBox.innerHTML = '';
            if (history.length > 0) {
                history.forEach(msg => addMessageToBox(msg.role === 'model' ? 'bot' : 'user', msg.content, msg.id, msg.feedback));
            } else {
                addMessageToBox('bot', 'Merhaba! Ben Kariyer PusulasÄ±. BaÅŸlamak iÃ§in, ilgi alanlarÄ±nÄ± anlatÄ±r mÄ±sÄ±n?');
            }
        } catch (error) {
            console.error("GeÃ§miÅŸ alÄ±namadÄ±:", error);
        }
    });

    userInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') handleSendMessage(); });
</script>
</body>
</html>